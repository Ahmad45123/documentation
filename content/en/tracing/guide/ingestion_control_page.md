---
title: Ingestion Control Page v2
kind: documentation
aliases:
    - /account_management/billing/usage_control_apm/
    - /tracing/app_analytics/
description: "Learn how to control Ingestion and Indexing rates with Tracing without Limits."
---

<div class="alert alert-warning">
  Ingestion Control page v2 is in private beta. Contact <a href="/help/">Datadog support</a> to request access for your organization. The support team sends you a notification when the new ingestion control page is enabled for your organization. The Ingestion Control page v2 replaces the former <a href="/tracing/trace_retention_and_ingestion/#ingestion-controls">Ingestion Controls</a></div>

Ingestion Control page enables agent and tracing librairies level visibility on the ingestion configuration of your applications and services. From the [ingestion control configuration page][1] , you can :
- Investigate and act on potential ingestion configuration issues (Agent limited CPU or RAM resources)
- Check service level ingestion configuration and adjust traces-per-second sampling rates for high throughput services.
- Understand which ingestion mechanisms are responsible for sampling most of your traces.

{{< img src="tracing/trace_indexing_and_ingestion/ingestion_control_page.png" style="width:100%;" alt="Retention Filters" >}}

All metrics used in the page are based on live traffic data of the **past 1 hour**. Any agent or library configuration change will be reflected in the page.

## Summary accross all environments

Get an overview of the total ingested data over the past hour, the active APM intrastructure (hosts, fargate tasks and serverless functions), as well as an estimation of your monthly ingestion quota. If the quota is less than `100%`, the projected ingested data fits in your [monthly allotment][2] of 150GB per host.

## Service Table View

The service table contains information about the ingestion configuration :

Services
: The name of each service sending traces to Datadog. The table contains root and non-root services.

Ingested Traces/s
: Average number of traces per second ingested into Datadog for the service over the past one hour.

Ingested Bytes/s
: this is

Downstream Bytes/s
: this is

Ingestion Rate
: A percentage from 0 to 100% of how many of the spans that are produced by the service are being ingested by Datadog.Any number lower than 100% means some traces are not being ingested by Datadog from the Datadog Agent, and these traces are be dropped by the Datadog Agent after metrics and stats have been calculated.

Traffic Breakdown
: A detailed breakdown of the destination of every trace generated by the service. See [Ingestion Breakdown](#ingestion-breakdown) for more information.

Tracing Libraries Configuration
: Shows `Default` unless changed by using the instructions in-app to configure the tracer. See [Change the Default Ingestion Rate](#change-the-default-ingestion-rate) for more information. If all hosts with this service deployed are configured to send a specific volume of traces, this indicator displays `Fully Configured`. If only a portion of hosts with this service deployed are configured, the label instead shows `Partially Configured`.

Dropped Spans
: The percentage of incoming spans dropped by the Datadog Agent.If this percent is higher than 0%, the service can be configured by clicking anywhere on the service row.See [Change the Default Ingestion Rate](#change-the-default-ingestion-rate) for more information.

In addition to the Data Ingestion column for each retention filter, there are also two metrics `datadog.estimated_usage.apm.ingested_spans` and `datadog.estimated_usage.apm.ingested_bytes`. These metrics are tagged by `service` and `env`, and top lists are available within the [Trace Analytics Dashboard][3] to show where the highest ingestion volumes are occurring. See the [Usage Metrics][4] documentation for more information.

### Change the default ingestion rate

{{< img src="tracing/trace_indexing_and_ingestion/ChangeIngestRate3.mp4" style="width:100%;" alt="Change the Data Ingestion Rate" video=true >}}

To specify that a specific percentage of a service's traffic should be sent, add a generated code snippet to your tracer configuration for that service.

1. Select the service you want to change the ingested span percent for.
2. Choose the service language.
3. Choose the desired ingestion percentage.
4. Apply the appropriate configuration generated from these choices to the indicated service and redeploy.
5. Confirm on the Data Ingestion page that your new percentage has been applied.

#### (Recommended) Setting the global ingestion rate to 100%

In order to ingest 100% of your traces in Datadog for all services for live search and analytics as well as to have the most control with retention filters, Datadog recommends configuring all services to send 100% of traces by default.

To configure for 100% ingestion on every service instrumented with a Datadog tracing library, set the following environment variable in the tracer configuration:

```
DD_TRACE_SAMPLE_RATE=1.0
```

**Note:** This may impact your bill if your total ingestion exceeds the included GBs. For more information, see the [APM Billing][5] page.

### Ingestion breakdown

The Ingestion Breakdown column breaks down the destination of all traces originating from the service. It can help you understand lower than expected ingestion rates and missing traces.

{{< img src="tracing/trace_indexing_and_ingestion/IngestionBreakdown.png" style="width:100%;" alt="breakdown of traces ingested" >}}

The breakdown is composed of the following parts:

- **Complete traces ingested** (green): The percentage of traces that have been ingested by Datadog.
- **Complete traces not retained** (gray): The percentage of traces that have intentionally not been forwarded to Datadog by the agent or the tracer. This can happen for one of two reasons depending on your configuration:

    1. By default, the agent and the tracers intelligently set the service ingestion rate. See [Change the Default Ingestion Rate](#change-the-default-ingestion-rate) to configure this behavior.
    2. When you change the default ingestion rate to less than 100%.

- **Complete traces dropped by the tracer rate limiter** (orange): When you choose to [configure the ingestion rate of a service](#change-the-default-ingestion-rate), you explicitly define the ingestion rate that your service should have. However, as a protection mechanism, a rate limiter set to 100 traces per second by default is automatically enabled. To configure this rate limiter, [open a support ticket][6] to have someone help guide you through the process.

- **Traces dropped due to the agent CPU limit** (red): The agent has a configuration option allowing users to limit the usage of the CPU. After this limit is reached the agent stops accepting traces from the tracers. Change the [agent configuration][7] to configure how much CPU to allocate to the agent.

### Traces dropped before ingestion

100% trace ingestion cannot be achieved if you have not set the environment variable configuration `DD_TRACE_SAMPLE_RATE=1.0` for Tracing without Limits, and:
- your applications generate above 50 traces per second;
- your applications send intermittent traffic loads; or
- your applications traces are large in size or otherwise have complicated trace payloads.

In this case, some traces are dropped by the Datadog Agent *after* stats are computed, so that metrics calculated are based on 100% of your traces.

If you are seeing ingestion rates below 100% within Datadog and would like to send all your traces, enable Tracing without Limits by setting the environment variable as described above. If you have questions, contact [support][6].

{{< img src="tracing/trace_indexing_and_ingestion/VisualIndicator.png" style="width:100%;" alt="Root services not sending 100% of traces" >}}

## Service Ingestion Summary

[1]: https://app.datadoghq.com/apm/traces/ingestion-control
[2]: /pricing/?product=apm--continuous-profiler
[3]: https://app.datadoghq.com/dash/integration/30337/app-analytics-usage
[4]: /tracing/trace_retention_and_ingestion/usage_metrics
[5]: /account_management/billing/apm_distributed_tracing/
[6]: /help/
[7]: https://github.com/DataDog/datadog-agent/blob/master/pkg/config/config_template.yaml#L736-L741
