---
title: Instrumenting .NET Serverless Applications
kind: documentation
further_reading:
- link: 'serverless/serverless_tagging/'
  tag: "Serverless"
  text: 'Tagging Serverless Applications'
- link: 'serverless/distributed_tracing/'
  tag: "Serverless"
  text: 'Tracing Serverless Applications'
- link: 'serverless/custom_metrics/'
  tag: "Serverless"
  text: 'Submitting Custom Metrics from Serverless Applications'
---

To instrument your .NET serverless application, you must use **either** the the [Datadog Lambda Extension][1] (beta) or the [Datadog Forwarder Lambda function][2].

Note that only the Datadog Lambda Extension supports the `x86_64` architecture only for .NET Lambda functions. If your .NET Lambda function uses the `arm64` architecture, you must use the Datadog Forwarder for instrumentation.

## Instrumentation
### Datadog Lambda Extension

<div class="alert alert-warning">
Instrumenting .NET applications with the Datadog Lambda Extension is in beta.
</div>

The Datadog Lambda Extension supports functions deployed as zip archives and functions deployed as container images. Choose your deployment package type below to see the applicable installation instructions.

{{< tabs >}}
{{% tab "Zip archive" %}}

1. Add the [Datadog Lambda Extension][1] layer to your Lambda function:

`arn:aws:lambda:<AWS_REGION>:464622532012:layer:Datadog-Extension:<EXTENSION_VERSION>`

Note that only the `x86_64` version of the Datadog Lambda Extension is supported for .NET Lambda functions. If your .NET Lambda function uses the `arm64` architecture, you must use the Datadog Forwarder for instrumentation.

2. Add the dd-trace-dotnet layer to your Lambda function:

<!-- TODO: add ARN here -->

3. Add your [Datadog API Key][2] to the Lambda function using the environment variable `DD_API_KEY`.

4. Configure your Lambda function with the following additional environment variables:

```
DD_TRACE_ENABLED = true
CORECLR_ENABLE_PROFILING = 1
CORECLR_PROFILER = {846F5F1C-F9AE-4B07-969E-05C26BC060D8}
CORECLR_PROFILER_PATH = /opt/datadog/Datadog.Trace.ClrProfiler.Native.so
DD_DOTNET_TRACER_HOME = /opt/datadog
DD_INTEGRATIONS = /opt/datadog/integrations.json
```

[1]: /serverless/libraries_integrations/extension/
[2]: https://app.datadoghq.com/organization-settings/api-keys

{{% /tab %}}
{{% tab "Container image" %}}

<!-- TODO: Add instructions for container images here -->

{{% /tab %}}
{{< /tabs >}}

### Datadog Forwarder
#### Install

1. Enable [AWS X-Ray active tracing][1] for your Lambda function.
2. Install the [AWS X-Ray SDK for .NET][2].

#### Subscribe

Subscribe the Datadog Forwarder Lambda function to each of your function's log groups to send metrics, traces, and logs to Datadog.

1. [Install the Datadog Forwarder if you haven't][3].
2. [Subscribe the Datadog Forwarder to your function's log groups][4].

#### Monitor custom business logic

If you would like to submit a custom metric using the Datadog Forwarder, see the sample code below:

```csharp
var myMetric = new Dictionary<string, object>();
myMetric.Add("m", "coffee_house.order_value");
myMetric.Add("v", 12.45);
myMetric.Add("e", (int)(DateTime.UtcNow - new DateTime(1970, 1, 1)).TotalSeconds);
myMetric.Add("t", new string[] {"product:latte", "order:online"});
LambdaLogger.Log(JsonConvert.SerializeObject(myMetric));
```

For more information on custom metric submission, see the [Serverless Custom Metrics documentation][3].


[1]: https://docs.aws.amazon.com/xray/latest/devguide/xray-services-lambda.html
[2]: https://docs.aws.amazon.com/xray/latest/devguide/xray-sdk-dotnet.html
[3]: /serverless/forwarder/
[4]: /serverless/libraries_integrations/extension/

## Tagging

Although it's optional, Datadog recommends tagging your serverless applications with the `env`, `service`, and `version` tags following the [unified service tagging documentation][3].

## Collect logs from AWS serverless resources

Serverless logs generated by managed resources besides AWS Lambda functions can be hugely valuable in helping identify the root cause of issues in your serverless applications. Datadog recommends you forward logs from the following managed resources in your environment:
- APIs: API Gateway, AppSync, ALB.
- Queues & Streams: SQS, SNS, Kinesis.
- Data Stores: DynamoDB, S3, RDS, etc.

To collect logs from non-Lambda AWS resources, install and configure the [Datadog Forwarder][9] to subscribe to each of your managed resource CloudWatch log groups.
## Further Reading

{{< partial name="whats-next/whats-next.html" >}}

[1]: /serverless/libraries_integrations/extension/
[2]: /serverless/forwarder/
[3]: /serverless/custom_metrics?tab=otherruntimes
